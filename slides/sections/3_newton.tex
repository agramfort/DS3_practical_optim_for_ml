% !TEX root = ../ds3.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Newton method}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Newton method: intuition}
%
\alert{Taylor expansion} to the order 2:
%
    \begin{align*}
        f(w^{k+1}) 
        \sim &
        f(w^{k}) 
        + \langle \nabla f (w^{k}), w^{k+1} - w^{k} \rangle 
        \\
        &\underbrace{+ \frac{1}{2} (w^{k+1} - w^{k})^\top \nabla^2 f (w^{k}) (w^{k+1} - w^{k})}_{\tilde{f}(w^{k+1})}
    \end{align*}
%
\pause
%
The \alert{`surrogate`} is minimized:
    \begin{align*}
        0 
        & = \nabla \tilde{f}(w^{k+1})
        = \nabla f (w^{k})
        + \nabla^2 f (w^{k}) (w^{k+1} - w^{k})
    \end{align*}
%
\pause
%
This leads to the following update for the \alert{Newton algorithm}:
    \begin{align*}
        w^{k+1} 
        &= 
        w^{k} 
        - [\nabla^2 f (w^{k})]^{-1} \nabla f (w^{k})
    \end{align*}
%
\pause
%
\center
What about convergence guarantees?
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[t]\frametitle{Convergence of Newton method}
    \begin{Theorem}[Convergence of Newton method]
    Suppose that $f$ is twice differentiable, and the Hessian $\nabla^2 f(w^*)$ is Lipschitz continuous in a neighborhood of a solution $w^*$
    such that $\nabla f(w^*) = 0$ and $\nabla^2 f(w^*) \succ 0$.
    
    Then there exists a closed ball $\mathcal{B}$ centered on $w^*$,
    such that for every $w^0 \in \mathcal{B}$, the sequence $w^k$ obtained
    with Newton algorithm stays in $\mathcal{B}$ and converges towards $w^*$.
    Furthermore, there is a constant $\gamma > 0$, such that
    $\|w^{k+1} - w^* \| \leq \gamma \|w^{k} - w^* \|^2$.
    \end{Theorem}
    \pause
    Drawbacks:
    \begin{itemize}
        \item \alert{Convergence} of Newton is \alert{local} (see proof in \footfullcite[Thm. 3.5]{Nocedal_Wright06}).
        The method \alert{may diverge} if the initial point is too far
        from $w^*$ or if the Hessian is \alert{not positive definite}
        \item One has to solve a linear system at each step! $O(p^3)$
    \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[t]\frametitle{From Newton to quasi-Newton}
    %
    
    Idea:
    \begin{itemize}
        \item Construct iterative approximations of the inverse of the Hessian \footfullcite{Nocedal1980}
        \item Combine it with line-search strategies
    \end{itemize}
    
    \pause
    \vspace{1em} 

    \begin{equation*}
        \begin{cases}
            d^k 
            &= -B^k g^k 
            \quad \text{find a \alert{descent direction}}
            \\
            w^{k+1} 
            &= w^k + \alpha^k d^k
             \quad \text{\alert{line-search}}
        \end{cases}
    \end{equation*}
    
    \vspace{2em}
    
    \textcolor{blue}{TODO finish talk about multiples update rules}
    
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Exercise: lab2 'logistic Newton'}
    Your turn!
    
    \begin{itemize}
        \item  Play with L-BFGS to gain insight! 
        \item Implement an $\ell_2$ regularized logistic regression with bias yourself!
        \item Implement a Newton method yourself!
    \end{itemize}
    
    \vspace{2em}
    
    Reminders! 
    \begin{itemize}
        \item In all the labs the main algorithm is already coded, and we propose you to add little modifications
        \item All the solutions are in the solutions folder
    \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
